
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Diagrams &#8212; miros 2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Zero To One" href="zero_to_one.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <blockquote id="reading-diagrams-reading-diagrams">
<div><p><em>If I can’t picture it, I can’t understand it</em></p>
<p class="attribution">&mdash;Albert Einstein</p>
</div></blockquote>
<div class="section" id="diagrams">
<h1>Diagrams<a class="headerlink" href="#diagrams" title="Permalink to this headline">¶</a></h1>
<p>In the 1990s a number of people got together an collected all of the different
popular ways of drawing pictures of software into one standard called UML
(unified modeling language).  The Harel formalism (the way David Harel wanted us
to draw statecharts) was included in UML.</p>
<p>Unfortunately, UML has fallen out of favor because the committee controlling it
produced something that the software community didn’t want.  There are many
different reasons for this, but it is safe to say that it is no longer popular.
In fact, UML, in some ways, has become a kind of anti-brand.</p>
<p>But they left behind some useful technology.  A number of open source
diagramming tools still exist with which we can quickly draw our statecharts.</p>
<p>Martin Fowler rendered down the complexity of the UML standard into : <a class="reference external" href="https://martinfowler.com/books/uml.html">UML
distilled</a>.  If you want a very solid
understanding about Harel formalism as it relates to UML, go to the source and
read <a class="reference external" href="https://sourceforge.net/projects/qpc/files/doc/PSiCC2.pdf/download">Practical UML Statechart in C/C++, 2nd Edition</a> by Miro
Samek.</p>
<p>But do you need to read these books before you use UML?  No, not really, this
section should give you enough information so that you can make your own
pictures.</p>
<p>At some point another attempt will be made to standardize the current best
practices for diagramming our software systems.  Maybe it will incorporate all
of the new programming idioms.  Until then we can limp along with UML.</p>
<div class="section" id="a-warning-about-diagramming">
<span id="reading-diagrams-a-warning-about-diagramming"></span><h2>A Warning about Diagramming<a class="headerlink" href="#a-warning-about-diagramming" title="Permalink to this headline">¶</a></h2>
<p>Be aware that as you draw your pictures, you will lock-in your thinking.</p>
<p>You and everyone on your team will be effected by the Sunk Cost Fallacy:  “Your
decisions are tainted by the emotional investments you accumulate, and the more
you invest in something the harder it becomes to abandon”. <a class="footnote-reference" href="#id4" id="id1">[1]</a></p>
<p>If you build beautiful drawings with a graphic design application; you will need
to put time and effort into them and you will probably become emotionally
attached to them.  Remember, your diagrams are just mistakes in the right
direction.  You need to be able to destroy these pictures, just as casually as
you would refactor your code.</p>
<p>So use a simple and fast moving tool that almost draws the pictures for you; I
use UMLet.  With UMLet you can build custom templates.  <a class="reference external" href="https://github.com/aleph2c/umlet-statechart-template">Here is the custom
template I use</a>.  It is
hard to fall in love with a picture made by UMLet.</p>
<p>You don’t have to use this tool or this template, there <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_Unified_Modeling_Language_tools">a lot of other UML drawing
tools available</a>.</p>
<p>Another way to make your pictures easy to change is to limit the amount of
detail on them.  You don’t have to draw every class and you can shrink a
complicated statechart into a kind of short hand.</p>
<p>UML can’t begin to describe what you write with your Python code.  So, if you
need to express a code’s idea on the diagram, just write the code directly onto
the picture.</p>
</div>
<div class="section" id="classes">
<span id="reading-diagrams-classes"></span><h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<p>The class is a blueprint for an object.</p>
<p>Typically, your class diagram would have a name and it would describe the
important variables (attributes) and functions (methods) of your class.  I tend
to put a little line between these when I’m diagramming them.</p>
<a class="reference external image-reference" href="_static/class_1.pdf"><div align="center" class="align-center"><img alt="_images/class_1.svg" src="_images/class_1.svg" /></div>
</a>
<p>If your class inherits from another class, you draw it with the inheritance
arrow (the ToasterOven <em>is an</em> ActiveObject):</p>
<a class="reference external image-reference" href="_static/class_2.pdf"><div align="center" class="align-center"><img alt="_images/class_2.svg" src="_images/class_2.svg" /></div>
</a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="k">class</span> <span class="nc">ToaterOven</span><span class="p">(</span><span class="n">ActiveObject</span><span class="p">):</span>
  <span class="c1"># ...</span>
</pre></div>
</div>
<p>If the object that is instantiated from your class, constructs another
object, of another class, you can draw this with the composite arrow (The toaster
oven <em>has a</em> light):</p>
<a class="reference external image-reference" href="_static/class_3.pdf"><div align="center" class="align-center"><img alt="_images/class_3.svg" src="_images/class_3.svg" /></div>
</a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ToasterOven</span><span class="p">(</span><span class="n">ActiveObject</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">light</span> <span class="o">=</span> <span class="n">Light</span><span class="p">()</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>If your object references another object that already exists, you can draw this
with an aggregation arrow (The toaster oven <em>has a</em> relay).</p>
<a class="reference external image-reference" href="_static/class_4.pdf"><div align="center" class="align-center"><img alt="_images/class_4.svg" src="_images/class_4.svg" /></div>
</a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">relay</span> <span class="o">=</span> <span class="n">Relay</span><span class="p">()</span>

<span class="c1"># ...</span>
<span class="k">class</span> <span class="nc">ToasterOven</span><span class="p">(</span><span class="n">ActiveObject</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relay</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relay</span> <span class="o">=</span> <span class="n">relay</span>
    <span class="c1"># ...</span>

<span class="n">toaster_oven</span> <span class="o">=</span> <span class="n">ToasterOven</span><span class="p">(</span><span class="n">relay</span><span class="p">)</span>
</pre></div>
</div>
<p id="reading-diagrams-backwards-arrows">Oh, but wait, did you notice the aggregation and composition arrows are
backwards?  This was done for a good reason, the arrow head (diamond looking
thing) is on the side that owns the other thing.  So at a glance you can see who
owns what.</p>
<a class="reference external image-reference" href="_static/arrow_pear.pdf"><div align="center" class="align-center"><img alt="_images/arrow_pear.svg" src="_images/arrow_pear.svg" /></div>
</a>
<p>The composite arrow is black because when your object is destroyed, so is the
object that it has built within it.</p>
<a class="reference external image-reference" href="_static/arrow_pear_2.pdf"><div align="center" class="align-center"><img alt="_images/arrow_pear_2.svg" src="_images/arrow_pear_2.svg" /></div>
</a>
<p>These mnemonics should help you when you are diagramming.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>These class diagrams are ill conceived since you have to know about all sorts
of activity in the background before you understand them.  You have to know
that the relationships are between the objects that are instantiated and not
the classes themselves.  As Dave Thomas (of Pragmatic fame) says, “[Python] is
not about class oriented programming, it’s an object oriented programming
language, yet UML draws everything with classes.”</p>
<p class="last">So treat the class diagrams as a quick reference to provide your statechart
some context, or just a kind of throw away thing.  Use lots of class shorthand
pictures if you are going to draw a few different classes on the same diagram.
Your actual classes are well defined in your Python code, so you can use your
code-tools (ctag/cscope) to see the class hierarchies and who references what
within your editor.</p>
</div>
<p>Martin Fowler spends over two chapters of <a class="reference external" href="https://martinfowler.com/books/uml.html">UML distilled</a> writing about class diagrams.  You
can make them really complicated if you want.</p>
<p>If you are using the miros package, you are rightfully managing your system’s
complexity using statecharts and not with classes.  So drawing detailed pictures
using class diagrams is not a good use of your time.</p>
</div>
<div class="section" id="inheritance-and-miros">
<span id="reading-diagrams-inheritance"></span><h2>Inheritance and miros<a class="headerlink" href="#inheritance-and-miros" title="Permalink to this headline">¶</a></h2>
<p>Within the context of this library, you would inherit from either the
ActiveObject or the ActiveFactory to gain access to the event processor, and all
of the other useful methods which would drive your statechart.  Then, you can
either attach this class directly to your statechart, or make an intermediate
class that holds all of your worker-functions for the thing you are trying to
build.</p>
<a class="reference external image-reference" href="_static/class_6.pdf"><div align="center" class="align-center"><img alt="_images/class_6.svg" src="_images/class_6.svg" /></div>
</a>
<p>Inheritance is patching.  Patching is easy for a computer to do, but it’s a lot
harder for a human mind.  In the 1990’s when object oriented programming was
<em>the</em> raging fad, the computer science community really over-emphasized this
feature.  We have since learned that inheritance is like any good vitamin, if
you use too much of it, it becomes hazardous to your well-being.</p>
<p>So don’t over use inheritance or you will make your code <em>really</em> hard to debug
and maintain:</p>
<a class="reference external image-reference" href="_static/class_7.pdf"><div align="center" class="align-center"><img alt="_images/class_7.svg" src="_images/class_7.svg" /></div>
</a>
<p>It makes sense to inherit from an ActiveObject or an ActiveFactory, because you
probably have no intention of debugging this library’s code.  If you make a
subclass of one of these classes, you can put your specific worker functions and
named attributes in it; but will you ever need to subclass beyond that point?
Probably not; inheritance can get you into a lot of trouble if it’s too deep.</p>
<p>If you are going to inherit ask yourself if the “as-a” relationship holds true
when you use the two class names in a sentence.  “The ToasterOven class is an
ActiveObject”; yes, that makes sense.  Ok, I’ll use inheritance.</p>
<p>If you want all of the states of your statechart to react the same when they see
a specific event, use the <a class="reference internal" href="patterns.html#patterns-ultimate-hook"><span class="std std-ref">ultimate hook pattern</span></a>.
This gives you all of the benefits of inheritance while still having debuggable
code.</p>
</div>
<div class="section" id="events">
<span id="reading-diagrams-events"></span><h2>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h2>
<p>Any code which uses the miros library is event-driven.</p>
<p>This means that your software will be waiting for an occurrence of an event: a
mouse click, a stock price passing a certain threshold, or the arrival of a data
packet.  After recognizing the event your system will react to it, by
manipulating the hardware state or sending further internal events to itself.
After completing the processing of this event in accordance to your design, and
the Harel formalism (the rule book of the board game), the system will stop
processing; and wait for the next event.</p>
<p>An event has a name and an optional payload.  The event’s name is called a
signal name.  There are internal signal names, like entry, exit and init (black
dot’s on the diagram) and there are external signals; which are just names that
you define to track the real world events that your software is reacting to.</p>
<p>Here is how to make an external event in miros:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">signals</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">my_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">MY_EVENT</span><span class="p">)</span>
<span class="n">my_event_with_payload</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">MY_EVENT</span><span class="p">,</span>
  <span class="n">payload</span><span class="o">=</span><span class="s2">&quot;with a payload that is just a string&quot;</span><span class="p">)</span>

<span class="n">MouseCoordinate</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;MouseCoordinates&quot;</span><span class="p">,</span>
  <span class="p">[</span><span class="s1">&#39;x_px&#39;</span><span class="p">,</span><span class="s1">&#39;y_px&#39;</span><span class="p">,</span><span class="s1">&#39;z_px&#39;</span><span class="p">]</span>

<span class="n">mouse_click_evt</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">MOUSE_CLICK</span><span class="p">,</span>
  <span class="n">payload</span><span class="o">=</span><span class="p">(</span><span class="n">MouseCoordinate</span><span class="p">(</span><span class="n">x_px</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">y_px</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">z_pz</span><span class="o">=</span><span class="mi">30</span><span class="p">)))</span>
</pre></div>
</div>
<p>Typically, external events like these come from outside of your statechart, so
you don’t have to draw them on your diagram.</p>
<p>The event is like a named marble that can roll on a groove, described by the
arrows of your statechart.  You can think of the groove as being pitched so that
a marble can only roll in one direction.  Any groove can have software written
on it, but this software will only run when a marble rolls over it.  This is how
these grooves can be drawn with UML:</p>
<a class="reference external image-reference" href="_static/Transition_Triggers.pdf"><div align="center" class="align-center"><img alt="_images/Transition_Triggers.svg" src="_images/Transition_Triggers.svg" /></div>
</a>
<p>In English, the above diagram would say, “If I receive an event with a signal
name “SIGNAL_NAME” while I am in source_state, run the guard, if it returns
True, run the action() function within the context of the source state, then add
the EVT_A event to my fifo queue so that it can be run during my next RTC
process, then transition to the target_state, but, if my guard code returns
False, ignore the event and do nothing”.</p>
<p>Your event can also run some code without causing a state transition; this is
called a hook:</p>
<a class="reference external image-reference" href="_static/hook_diagram_1.pdf"><div align="center" class="align-center"><img alt="_images/hook_diagram_1.svg" src="_images/hook_diagram_1.svg" /></div>
</a>
<p>In English, the above diagram would say, “If I receive an event with a signal
named “SIGNAL_NAME” while I am in source_state, run the guard, if it returns
True, run the action().  When I have finished running the action, stay in the
source_state.  If the guard returned false, ignore the event.”</p>
<p>Now that we understand how to draw external events on our diagrams we will talk
about internal events:</p>
<blockquote>
<div><ul class="simple">
<li>entry</li>
<li>exit</li>
<li>init (the black dot, which means, “Now what?”)</li>
</ul>
</div></blockquote>
<p>The entry and exit internal events, are just hooks:</p>
<a class="reference external image-reference" href="_static/Transition_Triggers_With_Internal_0.pdf"><div align="center" class="align-center"><img alt="_images/Transition_Triggers_With_Internal_0.svg" src="_images/Transition_Triggers_With_Internal_0.svg" /></div>
</a>
<p>The init internal event is drawn with something that UML calls a pseudostate;
which means a widget on your picture that is not a state.  The init signal is a
black dot connected to an arrow.</p>
<a class="reference external image-reference" href="_static/Transition_Triggers_With_Internal_1.pdf"><div align="center" class="align-center"><img alt="_images/Transition_Triggers_With_Internal_1.svg" src="_images/Transition_Triggers_With_Internal_1.svg" /></div>
</a>
<p>The internal events are triggered in reaction to transitions made by external
events on your diagram.</p>
</div>
<div class="section" id="event-processor-attachment-points">
<span id="reading-diagrams-event-processor-connection"></span><h2>Event Processor Attachment Points<a class="headerlink" href="#event-processor-attachment-points" title="Permalink to this headline">¶</a></h2>
<p>The event processor is the rule book for your statechart.  It is the thing that will
cause you to transition from one state to another, it will trigger internal
events and it will read and run all of your code as your code reacts to the
outside world.</p>
<p>To connect the event processor of your object to a statemachine; inherit it into
the class that will solve your problem, then draw the attachment point like this:</p>
<a class="reference external image-reference" href="_static/attachment_point_1.pdf"><div align="center" class="align-center"><img alt="_images/attachment_point_1.svg" src="_images/attachment_point_1.svg" /></div>
</a>
<p>I’m not sure if I’m using UML properly according to the standard, and I don’t
really care.  What I care about is if you understand what I mean.</p>
<p>In the context of this library an object instantiated with an event processor
can attach itself to a statemachine.  Another object instantiated with an event
processor can also attach to the same statemachine.</p>
<a class="reference external image-reference" href="_static/attachment_point_2.pdf"><div align="center" class="align-center"><img alt="_images/attachment_point_2.svg" src="_images/attachment_point_2.svg" /></div>
</a>
<p>The statemachine doesn’t keep track of variables or the current state; it simply
acts as a behavioral specification.  The object that was instantiated from the class
containing the event processor keeps track of it’s variable contents and state
information.  This is why the diagram is drawn this way.</p>
<a class="reference external image-reference" href="_static/attachment_point_3.pdf"><div align="center" class="align-center"><img alt="_images/attachment_point_3.svg" src="_images/attachment_point_3.svg" /></div>
</a>
<p>If you want to embed your state machine within your class, you can, you just
write it’s functions as staticmethods.  An embedded state chart might look like
this:</p>
<a class="reference external image-reference" href="_static/attachment_point_4.pdf"><div align="center" class="align-center"><img alt="_images/attachment_point_4.svg" src="_images/attachment_point_4.svg" /></div>
</a>
<p>As your team gets used to looking at these kinds of diagrams, you might create
a short hand for the attachment point, or leave it off of your diagram all
together.</p>
</div>
<div class="section" id="states">
<span id="reading-diagrams-states"></span><h2>States<a class="headerlink" href="#states" title="Permalink to this headline">¶</a></h2>
<p>The states in miros are just functions that you write that will react to events
send to them by the event processor.  They will have access to the attributes
and methods of the object that is referencing them, and they will be arranged in
a graph that is interpreted by the event processor (the rule book).</p>
<p>As a developer, you don’t have to solve the problems that the event processor
solves, instead you just learn some simple rules, then write your code into
your statechart functions.  But you don’t do this directly in one step, first
you learn how to draw simple pictures that are easy to think about.  Model these
pictures so that they map to your problem then write your code after you have a
decent idea about your design.  These pictures are called state machines, and
they come in many different UML flavors.</p>
<p>The Miro Samek algorithm doesn’t really care about the specifics of these
drawing conventions, since it supports finite state machines (with simple
states: Mealy or Moore) and hierarchical state machines (composite states) in
exactly the same way.</p>
<p>Here is a simple state, you would use it when drawing a finite state machine:</p>
<a class="reference external image-reference" href="_static/simple_state_1.pdf"><div align="center" class="align-center"><img alt="_images/simple_state_1.svg" src="_images/simple_state_1.svg" /></div>
</a>
<p>Here is an example of a finite state machine (FSM) – An oven.</p>
<a class="reference external image-reference" href="_static/simple_state_2.pdf"><div align="center" class="align-center"><img alt="_images/simple_state_2.svg" src="_images/simple_state_2.svg" /></div>
</a>
<p>Here is a composite state (a state that can have states within it):</p>
<a class="reference external image-reference" href="_static/composite_state_1.pdf"><div align="center" class="align-center"><img alt="_images/composite_state_1.svg" src="_images/composite_state_1.svg" /></div>
</a>
<p>Here is a simple hierarchical state machine (HSM) – A slightly better oven:</p>
<a class="reference external image-reference" href="_static/composite_state_2.pdf"><div align="center" class="align-center"><img alt="_images/composite_state_2.svg" src="_images/composite_state_2.svg" /></div>
</a>
<p>I think a lot of the terminology that was invented for UML came from exhausted
committees working on Friday afternoons, minutes before the weekend:  Any
state-looking-widget on your diagram that actually isn’t a state, is called a
pseudostate.  For instance, on our diagram, the black initialization dot and the
H with a star beside it (deep history) are both called pseudostates.</p>
<p>If you had to draw your statechart into a diagram that didn’t have enough room
for it, you might want to simplify it into a compacted representation.  This
would let the person reading your diagram know that there is more to it, but
that it was simplified on the picture so that everything would fit on the page.
For some reason this is called “decomposition hiding”.  I’ll demonstrate this by
hiding some of the details of our HSM oven:</p>
<a class="reference external image-reference" href="_static/composite_state_3.pdf"><div align="center" class="align-center"><img alt="_images/composite_state_3.svg" src="_images/composite_state_3.svg" /></div>
</a>
<p>The states aren’t useful without the assortment of arrows, internal events and
hooks that you will pepper all over your drawing.  In addition to this, there are
UML ways to solve some of the common problems that you will have when you try to
draw how your code works on a diagram.  Read on for the details.</p>
</div>
<div class="section" id="if-else-structures">
<span id="reading-diagrams-if-structures"></span><h2>If-Else Structures<a class="headerlink" href="#if-else-structures" title="Permalink to this headline">¶</a></h2>
<p>If you would like an event to be managed in different ways depending on some
condition, you would use an if-else structure.  In UML your if-else structures look
like diamonds with an event guard written on one of the arrows:</p>
<a class="reference external image-reference" href="_static/if_else_1.pdf"><div align="center" class="align-center"><img alt="_images/if_else_1.svg" src="_images/if_else_1.svg" /></div>
</a>
</div>
<div class="section" id="extending-arrows">
<span id="reading-diagrams-extending-arrows"></span><h2>Extending Arrows<a class="headerlink" href="#extending-arrows" title="Permalink to this headline">¶</a></h2>
<p>Often you will find it tricky to get all of your arrows packed onto your page.
If a number of arrows share the same kind of action, you can “join” them using a
bar:</p>
<a class="reference external image-reference" href="_static/join_1.pdf"><div align="center" class="align-center"><img alt="_images/join_1.svg" src="_images/join_1.svg" /></div>
</a>
<p>You can also “fork” them using a bar too:</p>
<a class="reference external image-reference" href="_static/fork_1.pdf"><div align="center" class="align-center"><img alt="_images/fork_1.svg" src="_images/fork_1.svg" /></div>
</a>
</div>
<div class="section" id="terminate-icon">
<span id="reading-diagrams-terminate-pseudostate"></span><h2>Terminate Icon<a class="headerlink" href="#terminate-icon" title="Permalink to this headline">¶</a></h2>
<p>If you want to destroy your statechart upon reacting to an event, you can use
the terminate pseudostate (icon):</p>
<a class="reference external image-reference" href="_static/terminate_1.pdf"><div align="center" class="align-center"><img alt="_images/terminate_1.svg" src="_images/terminate_1.svg" /></div>
</a>
</div>
<div class="section" id="final-icon">
<span id="reading-diagrams-final-state"></span><h2>Final Icon<a class="headerlink" href="#final-icon" title="Permalink to this headline">¶</a></h2>
<p>If your event has completed all of the work required in the enclose region, you
can draw this with the final state icon:</p>
<a class="reference external image-reference" href="_static/final_1.pdf"><div align="center" class="align-center"><img alt="_images/final_1.svg" src="_images/final_1.svg" /></div>
</a>
<p>It might make sense to use this if you want some code to run upon the
initialization of the state, but you do not want to transition deeper into the
state machine:</p>
<a class="reference external image-reference" href="_static/final_2.pdf"><div align="center" class="align-center"><img alt="_images/final_2.svg" src="_images/final_2.svg" /></div>
</a>
</div>
<div class="section" id="fall-through">
<h2>Fall Through<a class="headerlink" href="#fall-through" title="Permalink to this headline">¶</a></h2>
<p>The miros event handler can do something that I haven’t seen specified anywhere,
it can do a kind of catch and release, where an event can be processed by a
state, then released outward into the statechart to be processed by an outer
state.</p>
<a class="reference external image-reference" href="_static/fall_through_1.pdf"><div align="center" class="align-center"><img alt="_images/fall_through_1.svg" src="_images/fall_through_1.svg" /></div>
</a>
<p>I draw this with an un-attached arrow.  The arrow has code marked on it, but it
does not connect to anything, to express that it is not locally handled, so that
the event processor will recurse outward in it’s search to find where it is
handled.  The action on the unhandled arrow is a kind of side effect that can
provide some useful features.</p>
<a class="reference external image-reference" href="_static/catchandrelease1.pdf"><div align="center" class="align-center"><img alt="_images/catchandrelease1.svg" src="_images/catchandrelease1.svg" /></div>
</a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is not in the UML standard</p>
</div>
</div>
<div class="section" id="deep-history-icon">
<span id="reading-diagrams-deep-history-dot"></span><h2>Deep History Icon<a class="headerlink" href="#deep-history-icon" title="Permalink to this headline">¶</a></h2>
<p>If an event has caused you to leave a state deeply embedded in your statechart,
but you would like to transition back to that state after the interruption, you
can use the deep history pseudostate, it’s a circle enclosing a H*:</p>
<a class="reference external image-reference" href="_static/TransitionToHistoryStatePattern.pdf"><div align="center" class="align-center"><img alt="_images/TransitionToHistoryStatePattern.svg" src="_images/TransitionToHistoryStatePattern.svg" /></div>
</a>
</div>
<div class="section" id="subscription-and-publishing-icons">
<span id="reading-diagrams-publishing-to-other-charts"></span><h2>Subscription and Publishing Icons<a class="headerlink" href="#subscription-and-publishing-icons" title="Permalink to this headline">¶</a></h2>
<p>If you are publishing an event to another chart, it is often very useful to have
your eyes fall on this immediately while looking at your diagram.  It is an
output.  I use a red dot to signify this, red, because the event is currently
stopped, as it is waiting for processing in a queue.</p>
<p>Likewise, if you have subscribed to an event being posted by another chart, it’s
often very useful to have your eyes fall immediately on where it is being acted
upon.  It is an input.  I use a green dot, to show that this signal is going, or
being acted upon by the statechart which has subscribed to it</p>
<a class="reference external image-reference" href="_static/pub_sub_icons.pdf"><div align="center" class="align-center"><img alt="_images/pub_sub_icons.svg" src="_images/pub_sub_icons.svg" /></div>
</a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is not in the UML standard</p>
</div>
</div>
<div class="section" id="high-level-federation-diagrams">
<span id="reading-diagrams-high-level-dependency-diagrams"></span><h2>High Level Federation Diagrams<a class="headerlink" href="#high-level-federation-diagrams" title="Permalink to this headline">¶</a></h2>
<p>If you have a number of statecharts that are all working together to perform
some sort of collective action, it’s often very useful to see how they relate
to one another from a very high point of view.  For this I draw high level
dependency diagrams:</p>
<a class="reference external image-reference" href="_static/context_diagram.pdf"><div align="center" class="align-center"><img alt="_images/context_diagram.svg" src="_images/context_diagram.svg" /></div>
</a>
<p>When I need to write about a specific part of the system, I will change it’s
colour to draw my audience’s attention.  In this example I am trying to draw
your attention to the CacheFileChart used by the <a class="reference external" href="https://aleph2c.github.io/miros-rabbitmq/how_it_works.html">miros-rabbitmq plugin</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is not in the UML standard</p>
</div>
</div>
<div class="section" id="medium-level-construction-and-pub-sub-diagrams">
<span id="reading-diagrams-medium-level-construction-and-pub-sub-diagrams"></span><h2>Medium Level Construction and Pub/Sub Diagrams<a class="headerlink" href="#medium-level-construction-and-pub-sub-diagrams" title="Permalink to this headline">¶</a></h2>
<p>If you have build a federation of statecharts working together, you might want
to look at how a specific statechart works in the context of this federation
without looking at the details of its state machine.  This can be done with a
medium level contextual view.  You would identify what it publishes, what it’s
subscribed to and what it constructs to perform it’s roll:</p>
<a class="reference external image-reference" href="_static/medium_context_lan_chart.pdf"><div align="center" class="align-center"><img alt="_images/medium_context_lan_chart.svg" src="_images/medium_context_lan_chart.svg" /></div>
</a>
<p>This is a medium context diagram of the LanChart used by the <a class="reference external" href="https://aleph2c.github.io/miros-rabbitmq/how_it_works.html">miros-rabbitmq plugin</a>.  It uses two
“has a” composite arrows to show that it builds a CacheFileChart and a
LanRecceChart when it is constructed.  When the LanChart is destroyed, both the
CacheFileChart and the LanRecceChart will be destroyed as well.</p>
<p>We use the publish and subscribe icons to show about events are inputs (green)
and what events are outputs (red).  The payloads of the events are described as
well.  From this diagram we can see how are LanChart chart contributes to the
federation of our design.</p>
<p>What is missing is that the LanChart doesn’t describe who constructs it.  I
really shouldn’t because it doesn’t have access to this information.  To see
this, you would reference the detailed statechart diagram.</p>
</div>
<div class="section" id="detailed-statechart-diagrams">
<span id="reading-diagrams-detailed-statechart-diagrams"></span><h2>Detailed Statechart Diagrams<a class="headerlink" href="#detailed-statechart-diagrams" title="Permalink to this headline">¶</a></h2>
<p>The complete statechart is something that shows the topological nature of your
design with code marked upon it so you can quickly scan it and see what it’s
doing.  The publish and subscription dots are immediately visible and if you
need to further augment the chart with graphs to describe timing or whatever you
think will be useful, place those on the diagram too:</p>
<a class="reference external image-reference" href="_static/miros_rabbitmq_cache_file_chart.pdf"><div align="center" class="align-center"><img alt="_images/miros_rabbitmq_cache_file_chart.svg" src="_images/miros_rabbitmq_cache_file_chart.svg" /></div>
</a>
</div>
<div class="section" id="sequence-diagrams">
<span id="reading-diagrams-sequence-diagrams"></span><h2>Sequence Diagrams<a class="headerlink" href="#sequence-diagrams" title="Permalink to this headline">¶</a></h2>
<p>Sequence diagrams are very useful and extremely fragile to design changes.  The
<a class="reference external" href="https://github.com/aleph2c/sequence">can be generated directly from the trace instrumentation of the state machine</a> and quickly written up in plain text.
You can drop this plain text into your code or use it directly in your docs.</p>
<p>From this instrumentation trace log:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="n">doc_process</span><span class="p">]</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">()</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">statechart</span>
<span class="p">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="n">doc_process</span><span class="p">]</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">prototype</span><span class="p">()</span> <span class="n">statechart</span><span class="o">-&gt;</span><span class="n">code</span>
<span class="p">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="n">doc_process</span><span class="p">]</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">()</span> <span class="n">code</span><span class="o">-&gt;</span><span class="n">code</span>
<span class="p">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="n">doc_process</span><span class="p">]</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">communicate</span><span class="p">()</span> <span class="n">code</span><span class="o">-&gt;</span><span class="n">trace</span>
<span class="p">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">24</span><span class="p">]</span> <span class="p">[</span><span class="n">doc_process</span><span class="p">]</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="o">.</span><span class="n">rb</span><span class="p">()</span> <span class="n">trace</span><span class="o">-&gt;</span><span class="n">sequence_diagram</span>
</pre></div>
</div>
<p>To this sequence diagram:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>[ Chart: doc_process ] (?)
   spec       statechart        code             trace      sequence_diagram
     +-begin()-&gt;|                |                |                |
     |   (?)    |                |                |                |
     |          +--prototype()--&gt;|                |                |
     |          |      (?)       |                |                |
     |          |                +                |                |
     |          |                 \ (?)           |                |
     |          |                 debug()         |                |
     |          |                 /               |                |
     |          |                &lt;                |                |
     |          |                +-communicate()-&gt;|                |
     |          |                |      (?)       |                |
     |          |                |                +-sequence.rb()-&gt;|
     |          |                |                |      (?)       |
</pre></div>
</div>
<p>Avoid spending a lot of time on these diagrams, and avoid the more advanced
diagramming features, since to put effort into hand drawing a sequence diagram
while designing a reactive system will be a Sisyphean effort.</p>
</div>
<div class="section" id="payloads">
<span id="reading-diagrams-payloads"></span><h2>Payloads<a class="headerlink" href="#payloads" title="Permalink to this headline">¶</a></h2>
<p>Your statechart is running in its own thread.  An event can be published from
one thread and consumed by another thread.  This means if you put mutable data
in your event’s payload, you could be creating a shared global variable between
two separate threads.  Shared global information should be locked and unlocked
if it’s being used by multiple concurrent processes.</p>
<p>Instead of coming up with complicated locking mechanisms, wrap large common data
structures within their own statecharts and copy smaller payloads into named
tuples.  A named tuple is immutable, so you won’t accidentally shoot yourself in
the foot by inadvertently creating a global variable shared between two
different threads.  You can draw your payloads into your statecharts like this:</p>
<a class="reference external image-reference" href="_static/immutable_payload.pdf"><div align="center" class="align-center"><img alt="_images/immutable_payload.svg" src="_images/immutable_payload.svg" /></div>
</a>
<p>Pepper these payload descriptions all over your drawings, you might be repeating
yourself, but the quick understanding that you will be getting from a glance
will pay for this trade-off.  The <a class="reference external" href="https://docs.python.org/3.5/library/collections.html#collections.namedtuple">namedtuple is nice to work with</a>.</p>
<a class="reference internal" href="zero_to_one.html"<span class="std-ref">prev</span></a>, <a class="reference internal" href="index.html#top"><span class="std std-ref">top</span></a>, <a class="reference internal" href="examples.html"><span class="std std-ref">next</span></a><table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://youarenotsosmart.com/2011/03/25/the-sunk-cost-fallacy/">The Sunk Cost Fallacy</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="index.html">
  <img class="logo_a" src="_static/miros_a.svg" width="250" alt="Logo" >
</a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Diagrams</a><ul>
<li><a class="reference internal" href="#a-warning-about-diagramming">A Warning about Diagramming</a></li>
<li><a class="reference internal" href="#classes">Classes</a></li>
<li><a class="reference internal" href="#inheritance-and-miros">Inheritance and miros</a></li>
<li><a class="reference internal" href="#events">Events</a></li>
<li><a class="reference internal" href="#event-processor-attachment-points">Event Processor Attachment Points</a></li>
<li><a class="reference internal" href="#states">States</a></li>
<li><a class="reference internal" href="#if-else-structures">If-Else Structures</a></li>
<li><a class="reference internal" href="#extending-arrows">Extending Arrows</a></li>
<li><a class="reference internal" href="#terminate-icon">Terminate Icon</a></li>
<li><a class="reference internal" href="#final-icon">Final Icon</a></li>
<li><a class="reference internal" href="#fall-through">Fall Through</a></li>
<li><a class="reference internal" href="#deep-history-icon">Deep History Icon</a></li>
<li><a class="reference internal" href="#subscription-and-publishing-icons">Subscription and Publishing Icons</a></li>
<li><a class="reference internal" href="#high-level-federation-diagrams">High Level Federation Diagrams</a></li>
<li><a class="reference internal" href="#medium-level-construction-and-pub-sub-diagrams">Medium Level Construction and Pub/Sub Diagrams</a></li>
<li><a class="reference internal" href="#detailed-statechart-diagrams">Detailed Statechart Diagrams</a></li>
<li><a class="reference internal" href="#sequence-diagrams">Sequence Diagrams</a></li>
<li><a class="reference internal" href="#payloads">Payloads</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="zero_to_one.html" title="previous chapter">Zero To One</a></li>
      <li>Next: <a href="examples.html" title="next chapter">Examples</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/reading_diagrams.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Scott Volk.
      
      |
      <a href="_sources/reading_diagrams.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>