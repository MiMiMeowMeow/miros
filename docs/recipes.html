
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Recipes &#8212; miros 2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Patterns" href="patterns.html" />
    <link rel="prev" title="Simple Posting Example" href="postingexample.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="recipes">
<span id="id1"></span><h1>Recipes<a class="headerlink" href="#recipes" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="events-and-signals">
<span id="recipes-events-and-signals"></span><span id="posting-events"></span><h2>Events And Signals<a class="headerlink" href="#events-and-signals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-an-event">
<span id="recipes-creating-an-event"></span><h3>Creating an Event<a class="headerlink" href="#creating-an-event" title="Permalink to this headline">¶</a></h3>
<p>An event is something that will be passed into your statechart, it will be
reacted to, then removed from memory.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">Event</span>
  <span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span>

  <span class="n">event_1</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="s2">&quot;name_of_signal&quot;</span><span class="p">)</span>
  <span class="c1"># or</span>
  <span class="n">event_2</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">name_of_signal</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="creating-a-signal">
<span id="recipes-creating-a-signal"></span><h3>Creating a Signal<a class="headerlink" href="#creating-a-signal" title="Permalink to this headline">¶</a></h3>
<p>A signal is the name of an event.  Many different events can have the same
name, or signal.  When a signal is created, it is given a number which is one
higher than the oldest signal that was within your program.  You shouldn’t have
to worry about what a signal number is, they are only used to speed up the
event processor. (it is faster to compare two numbers than two strings)</p>
<p>When you create a signal it will not be removed from memory until your program
finishes.  They are created at the moment they are referenced, so you don’t
have to explicitly define them.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">Event</span>
  <span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span>

  <span class="c1"># signal named &quot;name_of_signaL&quot; invented</span>
  <span class="c1"># here and given a unique number</span>
<span class="hll">  <span class="n">event_1</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="s2">&quot;name_of_signal&quot;</span><span class="p">)</span>
</span>  <span class="c1"># the signal number of this event will have</span>
  <span class="c1"># the same number as in line 6</span>
  <span class="n">event_2</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">name_of_signal</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Notice that the signal was invented on line <strong>6</strong> then re-used on line <strong>9</strong>.</p>
<p>The signals are shared across your whole program.  To see reflect upon your
signals read <a class="reference internal" href="#recipes-seeing-your-signals"><span class="std std-ref">this</span></a>.</p>
</div>
<div class="section" id="recipes-seeing-what-signals-you-have-in-your-system">
<span id="id2"></span><h3>Posting Events<a class="headerlink" href="#recipes-seeing-what-signals-you-have-in-your-system" title="Permalink to this headline">¶</a></h3>
<p>The Active Object <code class="docutils literal"><span class="pre">post_fifo</span></code>, <code class="docutils literal"><span class="pre">post_lifo</span></code>, <code class="docutils literal"><span class="pre">defer</span></code> and <code class="docutils literal"><span class="pre">recall</span></code>
methods are use to feed events to the statechart.  An Event can be thought of
as a kind of named marble that is placed onto a topological map.  If a
particular elevation doesn’t know what to do with the marble, it rolls the
marble to the next lower elevation, or state.  If the lowest elevation is
reached and the program doesn’t know what to do, it just ignores the event, or
lets the marble fall out of play.</p>
<p>The name of the marble is the signal name. An event can have a payload, but it
doesn’t have to.  An event can only be posted to a chart after the chart has
started.  Otherwise the behavior of the active object is undefined.</p>
<p>The state methods typically react to the names of a event, or the signal names.
This means that the if-else structures that you write will use the signal names
in their logic.</p>
<p>If you use the chart’s post event methods within the chart, the chart will not
concern itself with <em>where</em> you initiated that event.  It will post its events
into its queue as if they were provided by the outside world.  In this way
these events are called <em>artificial</em>; instead of the world creating the event,
the chart does.  There are a number of situations where it makes sense to do
this, they will be described in the patterns section.</p>
</div>
<div class="section" id="posting-an-event-to-the-fifo">
<span id="recipes-posting-an-event-to-the-fifo"></span><h3>Posting an Event to the Fifo<a class="headerlink" href="#posting-an-event-to-the-fifo" title="Permalink to this headline">¶</a></h3>
<p>To post an event to the active object first-in-first-out (fifo) buffer, you
must have first started your statechart.  Here is a simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="c1"># start at &#39;outer&#39; for the sake of our example</span>
<span class="n">ao</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>

<span class="c1"># Send an event with the signal name &#39;mary&#39;</span>
<span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">mary</span><span class="p">))</span>
</pre></div>
</div>
<p>The signal names used by the events are common across the entire system.  You
do not need to declare them.  If the system had not seen the <code class="docutils literal"><span class="pre">signals.mary</span></code>
signal code before in our above example, this name would be added and assigned
a unique number automatically.</p>
</div>
<div class="section" id="posting-an-event-to-the-lifo">
<h3>Posting an Event to the Lifo<a class="headerlink" href="#posting-an-event-to-the-lifo" title="Permalink to this headline">¶</a></h3>
<p>To post an event to the active object last-in-first-out (lifo) buffer, you
must have first started your statechart.  Here is a simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="c1"># start at &#39;outer&#39; for the sake of our example</span>
<span class="n">ao</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>

<span class="c1"># Now say we want to send an event with</span>
<span class="c1"># th the signal name of &#39;mary&#39; to the chart</span>
<span class="n">ao</span><span class="o">.</span><span class="n">post_lifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">mary</span><span class="p">))</span>
</pre></div>
</div>
<p>You would post to the ‘lifo’ buffer if you needed your event to be moved to the
front of the active object’s collection of unprocessed events.  You might want
to do this with a timing heart beat or for any event that needs to be processed
with a greater priority than other events.</p>
</div>
<div class="section" id="creating-a-one-shot-event">
<span id="recipes-creating-a-one-shot-event"></span><h3>Creating a One-Shot Event<a class="headerlink" href="#creating-a-one-shot-event" title="Permalink to this headline">¶</a></h3>
<p>A one-shot event can be used to add some delay between state transitions.  You
can think of them as delayed <strong>init</strong> signals.  You might want to use a one-shot if
you need a system to settle down a bit before transitioning into an inner
state.</p>
<p>Generally speaking, you should cancel your one-shot events as your chart passes
control to outer states.  You don’t need to do this, but if you don’t your
outer states will be hit with one-shot messages that they don’t care about
and your chart will needlessly search as it reacts to these events.</p>
<p>It is important to know that if your chart changes state, the event posted to
it will look like it came from outside of your statechart, even though it was
originally generated within a given state.  The construction of any event with
the <code class="docutils literal"><span class="pre">fifo</span></code> or <code class="docutils literal"><span class="pre">lifo</span></code> api behaves like this.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here define a middle state the creates a one-shot event called</span>
<span class="c1"># delayed_one_second.  The same delayed_one_second signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">ao</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>

  <span class="c1"># we have entered the state and we would like to delay one</span>
  <span class="c1"># second prior to entering the inner state</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
      <span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span>
        <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">delay_one_second</span><span class="p">),</span>
        <span class="n">times</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span>
      <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="c1"># we are leaving this state for an outer state</span>
    <span class="c1"># so we cancel our one-shot in case it hasn&#39;t gone off yet</span>
    <span class="n">ao</span><span class="o">.</span><span class="n">cancel_events</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">delay_one_second</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="c1"># ignore our init</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="c1"># our one-shot has fired, one second has passed since</span>
  <span class="c1"># we transitioned into this state, now transition</span>
  <span class="c1"># to our desired target; &#39;inner&#39;</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">delay_one_second</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">ao</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>

  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">ao</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-multishot-event">
<span id="recipes-creating-a-multishot-event"></span><h3>Creating a Multishot Event<a class="headerlink" href="#creating-a-multishot-event" title="Permalink to this headline">¶</a></h3>
<p>A multi-shot event is just an extension of the one-shot idea.  Instead of only
being fired once on entry, it can be fired between 2 and an infinite number of
times.  You would use a multi-shot event if you would like to provide an inner
part of your chart with a heart beat that the outer part of your chart doesn’t
need to know about.  In this way you could save cycles by avoiding unnecessary
event processing in the parts of the chart that don’t need these heart beats.
This will also be useful while debugging your chart, your logs won’t be filled
with unnecessary events.</p>
<p>You should cancel your multi-shot events in the exit handler of the state that
created them.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here define a middle state the creates a multi-shot event called</span>
<span class="c1"># three_pulse.  The same three_pulse signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">ao</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">multi_shot_thread</span> <span class="o">=</span> \
      <span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">),</span>
                      <span class="n">times</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                      <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1"># We mark up the ao with this id, so that</span>
    <span class="c1"># state function can be used by many different aos</span>
    <span class="n">ao</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">multi_shot_thread</span><span class="p">,</span>
                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multi_shot_thread&#39;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">ao</span><span class="o">.</span><span class="n">cancel_event</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">multi_shot_thread</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">ao</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">ao</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>By setting the <code class="docutils literal"><span class="pre">times</span></code> argument of the <code class="docutils literal"><span class="pre">post_fifo</span></code> to 0, you can create an
infinite multi-shot event.  This is how you could make an inner heart beat.</p>
<p>The <code class="docutils literal"><span class="pre">post_lifo</span></code> api can be used the same as the <code class="docutils literal"><span class="pre">post_fifo</span></code> api for
creating these types of repeating events.  You would use the <code class="docutils literal"><span class="pre">post_lifo</span></code> api
when you would need your heart beat event signal to barge ahead of all other
events waiting to be processed by the active object.</p>
</div>
<div class="section" id="cancelling-a-specific-event-source">
<span id="recipes-cancelling-a-specific-event-source"></span><h3>Cancelling a Specific Event Source<a class="headerlink" href="#cancelling-a-specific-event-source" title="Permalink to this headline">¶</a></h3>
<p>The requests to the <code class="docutils literal"><span class="pre">post_fifo</span></code> and <code class="docutils literal"><span class="pre">post_lifo</span></code> methods, where <code class="docutils literal"><span class="pre">times</span></code> are
specified, can be thought of as event sources.  This is because they create
background threads which track time and periodically post events to the active
object.</p>
<p>There are two different ways to cancel event sources.  You can cancel a
specific event source, or you can cancel all event sources that create a
specific signal name (easier).  Read the
<a class="reference internal" href="#recipes-cancelling-event-source-by-signal-name"><span class="std std-ref">Cancelling Event Source By Signal Name</span></a> recipe to see how to do
this.</p>
<p>To cancel a specific signal source, you need to track the thread id which was
created when it was made, then use that id to cancel the event.  Since a state
method can be used by many different active objects, you don’t want to store
this id on the method itself, or in its variable name space.  Instead, you can
markup the name of the chart that is using the method, this <code class="docutils literal"><span class="pre">chart</span></code> object is
passed to the state method as the first argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here define a middle state the creates a multi-shot event called</span>
<span class="c1"># three_pulse.  The same three_pulse signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="c1">#</span>
<span class="c1"># We want to cancel this specific event source when we are exiting this</span>
<span class="c1"># state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">multi_shot_thread</span> <span class="o">=</span> \
      <span class="n">chart</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">),</span>
                      <span class="n">times</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                      <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1"># We graffiti the provided chart object with this id</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">multi_shot_thread</span><span class="p">,</span>
                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multi_shot_thread&#39;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">cancel_event</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">multi_shot_thread</span><span class="p">)</span>

    <span class="c1"># remove our graffiti</span>
    <span class="k">del</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">multi_shot_thread</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">augment</span></code> api is used to graffiti our chart upon entering the state.
We write the event-source id onto the <code class="docutils literal"><span class="pre">multi_shot_thread</span></code> chart attribute,
so that we can use it later.  By marking this specific <code class="docutils literal"><span class="pre">chart</span></code> object, the
middle state method handler can be shared by other active objects.</p>
<p>You would use this method of canceling an event source if you need the
three_pulse signal name elsewhere in your statechart.  If you do not intend on
re-using this signal name you can just cancel event sources using a much
simpler api: the <code class="docutils literal"><span class="pre">cancel_event</span></code>.</p>
</div>
<div class="section" id="cancelling-event-source-by-signal-name">
<span id="recipes-cancelling-event-source-by-signal-name"></span><h3>Cancelling Event Source By Signal Name<a class="headerlink" href="#cancelling-event-source-by-signal-name" title="Permalink to this headline">¶</a></h3>
<p>If you would like to re-use your event source signal names through your chart,
then you can use the <a class="reference internal" href="#recipes-cancelling-a-specific-event-source"><span class="std std-ref">Cancelling a Specific Event Source</span></a> recipe
to cancel a specific source and leave your other event sources running.
Otherwise, you can use the simpler <code class="docutils literal"><span class="pre">cancel_sources</span></code> api provided by the
Active Object:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here we define a middle state the creates a multi-shot event called</span>
<span class="c1"># three_pulse.  The same three_pulse signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="c1">#</span>
<span class="c1"># We want to cancel this specific event source when we are exiting this</span>
<span class="c1"># state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">),</span>
                    <span class="n">times</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="c1"># cancel all event sources with the signal named three_pulses</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">cancel_events</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">))</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>There is no need to keep a thread id for the event source, since the Active
Object can just look at all of the event source threads and kill any of them
that have this signal name provided to the <code class="docutils literal"><span class="pre">cancel_events</span></code> call.</p>
</div>
<div class="section" id="deferring-and-recalling-an-event">
<span id="recipes-deferring-an-event"></span><h3>Deferring and Recalling An Event<a class="headerlink" href="#deferring-and-recalling-an-event" title="Permalink to this headline">¶</a></h3>
<p>There will be situations where you want to post a kind of artificial event into
a queue which won’t immediately be acted upon by your startchart.  It is an
<cite>artificial</cite> event, because your chart is making it up, it isn’t being given to
it by the outside world.  It is a way for your chart to build up a kind of
processing pressure that can be relieved when you have the cycles to work on
things.</p>
<p>This is a two stage process, one, deferring the event, and two, recalling the
event.  It is called a deferment of an event because we are holding off our
reaction to it.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># code to place in the state that is deferring the event:</span>
<span class="n">chart</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">signal_that_is_deferred</span><span class="p">)</span>

<span class="c1"># code to place in the state where you would like the event reposted into</span>
<span class="c1"># the chart&#39;s first in first out queue</span>
<span class="n">chart</span><span class="o">.</span><span class="n">recall</span><span class="p">()</span> <span class="c1"># posts our deferred event to the chart.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="seeing-what-is-going-on">
<span id="id3"></span><h2>Seeing What is Going On<a class="headerlink" href="#seeing-what-is-going-on" title="Permalink to this headline">¶</a></h2>
<div class="section" id="determining-the-current-state">
<span id="recipes-determining-the-current-state"></span><h3>Determining the Current State<a class="headerlink" href="#determining-the-current-state" title="Permalink to this headline">¶</a></h3>
<p>To see what state your chart is in:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll">  <span class="n">chart</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fun</span>           <span class="c1"># will be the state method</span>
</span>  <span class="n">chart</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span>  <span class="c1"># will be the state method name</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="seeing-what-signals-you-have-in-your-system">
<span id="recipes-seeing-your-signals"></span><h3>Seeing what Signals You Have In Your System<a class="headerlink" href="#seeing-what-signals-you-have-in-your-system" title="Permalink to this headline">¶</a></h3>
<p>A signal is the name that can be given to an event.  To get access to your
signals:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span>
</pre></div>
</div>
<p>The signals object is provided by a singleton of the SignalSource class, which
is just an OrderedDictionary with a <code class="docutils literal"><span class="pre">__getattr__</span></code> method to make the syntax
easier to use.</p>
<p><cite>This basically means that you can think of the signals object as being a dict
that is shared across your whole program.</cite></p>
<p>To see your signals, you just reflect upon it like you would with any other
Python dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># To see your signal names:</span>
<span class="n">signal_names</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="c1"># To see your signal numbers:</span>
<span class="n">signal_numbers</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="c1"># To output your names and number:</span>
<span class="k">for</span> <span class="n">signal_name</span><span class="p">,</span> <span class="n">signal_number</span> <span class="ow">in</span> <span class="n">signals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="n">signal_name</span><span class="p">,</span> <span class="n">signal_number</span><span class="p">)</span>

<span class="c1"># same output with some formatting</span>
<span class="n">max_name_len</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
<span class="n">max_number_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">signal_name</span><span class="p">,</span> <span class="n">signal_number</span> <span class="ow">in</span> <span class="n">signals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{1: &lt;{0}} {2:{3}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_name_len</span><span class="p">,</span>
                                   <span class="n">signal_name</span><span class="p">,</span>
                                   <span class="n">signal_number</span><span class="p">,</span>
                                   <span class="n">max_number_len</span><span class="p">))</span>  <span class="c1"># output below -&gt;</span>
  <span class="c1"># ENTRY_SIGNAL            1</span>
  <span class="c1"># EXIT_SIGNAL             2</span>
  <span class="c1"># INIT_SIGNAL             3</span>
  <span class="c1"># REFLECTION_SIGNAL       4</span>
  <span class="c1"># SEARCH_FOR_SUPER_SIGNAL 5</span>
  <span class="c1"># ..</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-trace">
<span id="recipes-using-the-trace"></span><h3>Using the Trace<a class="headerlink" href="#using-the-trace" title="Permalink to this headline">¶</a></h3>
<p>If you would like to see what your active object was doing from a <strong>very high
level</strong>, you can look at it’s <cite>trace</cite> instrumentation.  The trace will only
create a log item if a state transition has occurred. Each line in the <cite>trace</cite>
will contain:</p>
<ol class="arabic simple">
<li>A datetime stamp between square brackets</li>
<li>The active object name, between square brackets</li>
<li>The event that caused the transition, its signal number and its payload</li>
<li>The starting state</li>
<li>The ending state</li>
</ol>
<p>If you haven’t named your active object, a unique identifier is given to it,
and the first 5 characters of this unique identifier will be used in the trace.
The reason that an identifier is given to it is so that the trace outputs, from
multiple active objects, can be distinguished from one another.</p>
<p>Suppose you have built the tazor active object described in the <a class="reference internal" href="postingexample.html#examples-tazor-example"><span class="std std-ref">second
example</span></a>. Suppose you named this active object <cite>tazor</cite>:
To see the trace you would type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tazor</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span>
</pre></div>
</div>
<p>This would output the following trace:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">28.268873</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
</span><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>Notice that on line one, the signal is called <cite>start_at</cite>.  There is no signal
called <cite>start_at</cite>, here the trace is actually using the method name <cite>start_at</cite>
to indicate how the chart was started.</p>
<p>A trace can be used with the <cite>sequence</cite> project to generate a sequence diagram,
more about that is described <span class="xref std std-ref">here.</span></p>
</div>
<div class="section" id="using-the-spy">
<span id="recipes-using-the-spy"></span><span id="reflection-an-extremely-detailed-view"></span><h3>Using the Spy<a class="headerlink" href="#using-the-spy" title="Permalink to this headline">¶</a></h3>
<p>If you need a <strong>very detailed description</strong> of your system’s behavior you will want
to use the <cite>spy</cite> instrumentation.  The spy outputs:</p>
<ol class="arabic simple">
<li>All of the internal activity that is run by the event processor</li>
<li>How your chart reacts to the events it has received</li>
<li>Information about what happened between each of the rtc activities.</li>
<li>If a signal was hooked by a state</li>
<li>If and when a signal was <a class="reference internal" href="#recipes-deferring-an-event"><span class="std std-ref">deferred</span></a></li>
<li>If and when a signal was <a class="reference internal" href="#recipes-deferring-an-event"><span class="std std-ref">recalled</span></a></li>
<li>The number of events awaiting immediate processing after a specific rtc activity.</li>
<li>The number of events which have had their processing deferred.</li>
</ol>
<p>If you don’t understand what these terms mean, read the
<a class="reference internal" href="postingexample.html#examples-simple-posting-example"><span class="std std-ref">simple posting example</span></a>, since it
introduces all of these ideas.</p>
<p>To access the full spy:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># import a pretty printer (like print)</span>
<span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">pp</span>

<span class="c1"># .. state charts and other code here</span>

<span class="c1"># Assuming your active object is called `ao`</span>
<span class="c1"># we use the pretty printer to write the</span>
<span class="c1"># full spy log to the terminal</span>
<span class="n">pp</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">spy</span><span class="p">())</span>
</pre></div>
</div>
<p>This might output:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="p">[</span><span class="s1">&#39;START&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:middle&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(0)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;A:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_DEFERRED:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:inner&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(1)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;A:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;A:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_DEFERRED:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:inner&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(2)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;A:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;A:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_DEFERRED:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:inner&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(3)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;D:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_FIFO:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:outer:HOOK&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(1) Deferred:(2)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;B:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;B:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;B:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_FIFO:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;RECALL:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:outer&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(1) Deferred:(1)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;B:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_FIFO:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;RECALL:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:outer&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(1) Deferred:(0)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;B:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:outer&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(0)&#39;</span><span class="p">]</span>
</span></pre></div>
</td></tr></table></div>
<p>If you would like to understand in detail how to read this log, and how it
might have occurred, reference <a class="reference internal" href="postingexample.html#examples-simple-posting-example"><span class="std std-ref">the example from which it
came</span></a>.</p>
<p>The spy log is a ring buffer that contains 500 spots.  This is so your system
can run forever without using an infinite amount of memory.  Once the internal
spy log has run out of room, it will shift out the old data and write the new
data at the tail end of its log.</p>
</div>
<div class="section" id="tracing-live">
<span id="recipes-tracing-live"></span><h3>Tracing Live<a class="headerlink" href="#tracing-live" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="spying-live">
<span id="recipes-spying-live"></span><h3>Spying Live<a class="headerlink" href="#spying-live" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="describing-your-work">
<span id="recipes-describing-your-work"></span><h2>Describing your Work<a class="headerlink" href="#describing-your-work" title="Permalink to this headline">¶</a></h2>
<div class="section" id="drawing-a-statechart">
<span id="recipes-drawing-a-statechart"></span><h3>Drawing a StateChart<a class="headerlink" href="#drawing-a-statechart" title="Permalink to this headline">¶</a></h3>
<p>The Harel formalism was consumed by the UML standard.</p>
<p>The UML standards were not properly curated and became over-complicated.
As a result, they are largely disregarded by the software community, so most of
the open source drawing tool projects have been abandoned.</p>
<p>UML is still useful in that it provides a common way of describing software
systems.  There is no reason not to use the parts of it that you like and leave
the parts of it that you either don’t understand or that are too complicated to
bother with. (This happens in C++ too)</p>
<p>To draw a statechart on a computer, you need a drawing tool.</p>
<p>For this tool to be useful, you need to be able to:</p>
<ol class="arabic simple">
<li>zoom in and out of a diagram. (asked for in 1987)</li>
<li>draw the basic Harel statemachine building blocks.</li>
<li>draw arrows and the other useful parts of UML</li>
<li>mark up the diagram with code</li>
<li>quickly and easily change your design</li>
</ol>
<p>I have yet to find an open source tool that doesn’t get in the way of me trying
to draw a simple picture, with boxes and arrows, where I can zoom in and out,
and write blocks of code anywhere I like.</p>
<p>Visio can do this, but it’s expensive and other people have to download a
viewer application in order to see your diagram.  The cheaper online alternatives,
force their own weird sub-versions of UML into their templates, so that once
again you start fighting with the tool.</p>
<p>Miro Samek wrote his own tool to deal with this problem and if you eventually
switch over to his code, you will be greatly appreciative of the speed and ease
in which you can manifest your ideas into pictures, then into running designs.
But his drawing tool is tightly coupled with his framework (as it should be),
so we can’t use that here either.</p>
<p>Pencil and paper are great for drawing your designs.  It is good to work on
them over and over again without the impediment of the computer interface
getting in your way.  Once you think you have it figured out you can transfer
the picture into something digital using a free tool called <a class="reference external" href="http://www.umlet.com/">umlet</a>.</p>
<p>There is also an online version of the tool, which is called <a class="reference external" href="http://www.umlet.com/umletino/umletino.html">umletino</a>.</p>
<p>The nice thing about this tool is that it is so simple to use.  It also makes
ugly pictures, which is a kind of good thing.</p>
<p>A UML diagram should be thought as graffiti on the wall, rather than a great
work of art.  It should be easy for you to change your design.  If it took you
5 hours to build a beautiful masterpiece you will feel a psychological
impediment to change it.  We don’t want to get locked into our thinking.</p>
</div>
<div class="section" id="drawing-a-sequence-diagram">
<span id="recipes-drawing-a-sequence-diagram"></span><h3>Drawing a Sequence Diagram<a class="headerlink" href="#drawing-a-sequence-diagram" title="Permalink to this headline">¶</a></h3>
<p>To create effective, yet inexpensive documentation, you can <a class="reference internal" href="reflection.html#reflection-a-high-level-description-of-the-behavior"><span class="std std-ref">first obtain
a trace of your system</span></a>,
then use it to generate a sequence diagram, with <a class="reference external" href="https://github.com/aleph2c/sequence">sequence</a>.</p>
<p>Without a lot of effort, you can configure your text editor to write these
pictures for you.  When I select this in my editor:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">28.268873</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>Then press &lt;ctrl-T&gt;, it becomes this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[ Chart: 75c8c ] (?)
     top        arming        armed
      +-tart_at()-&gt;|            |
      |    (?)     |            |
      |            +---BC()----&gt;|
      |            |    (?)     |
      |            |            +
      |            |             \ (?)
      |            |             BC()
      |            |             /
      |            |            &lt;
</pre></div>
</div>
<p>Then I would manually replace the question marks with numbers, so that
I could explained each event by referencing its number.  Since my diagram is in
ASCII, I could place it in my code comments.</p>
<p><a class="reference external" href="https://github.com/aleph2c/sequence">sequence</a> also works with interleaving trace outputs that would come from two
different interacting active objects:</p>
<p>Suppose you got this from your terminal while testing two different
statecharts:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">28.268873</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">28.268873</span><span class="p">]</span> <span class="p">[</span><span class="mi">95</span><span class="n">a8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">95</span><span class="n">a8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">OTHER</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">95</span><span class="n">a8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">95</span><span class="n">a8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>By running it through <a class="reference external" href="https://github.com/aleph2c/sequence">sequence</a> we would see:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[ Chart: 75c8c ] (?)
     top        arming        armed
      +-tart_at()-&gt;|            |
      |    (?)     |            |
      |            +---BC()----&gt;|
      |            |    (?)     |
      |            |            +
      |            |             \ (?)
      |            |             BC()
      |            |             /
      |            |            &lt;

[ Chart: 95a8c ] (?)
     top        arming        armed
      +-tart_at()-&gt;|            |
      |    (?)     |            |
<span class="hll">      |            +--OTHER()--&gt;|
</span>      |            |    (?)     |
      |            |            +
      |            |             \ (?)
      |            |             BC()
      |            |             /
      |            |            &lt;
</pre></div>
</div>
<p>Now I’ll write some fake documentation to make a point, notice how I update the
numbers in the diagram:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="n">Chart</span><span class="p">:</span> <span class="n">Unit</span> <span class="mi">1</span> <span class="p">]</span>
     <span class="n">top</span>        <span class="n">arming</span>        <span class="n">armed</span>
      <span class="o">+</span><span class="n">start_at</span><span class="p">()</span><span class="o">-&gt;|</span>            <span class="o">|</span>
      <span class="o">|</span>    <span class="p">(</span><span class="mi">1</span><span class="p">)</span>     <span class="o">|</span>            <span class="o">|</span>
      <span class="o">|</span>            <span class="o">+---</span><span class="n">BC</span><span class="p">()</span><span class="o">----&gt;|</span>
      <span class="o">|</span>            <span class="o">|</span>    <span class="p">(</span><span class="mi">3</span><span class="p">)</span>     <span class="o">|</span>
      <span class="o">|</span>            <span class="o">|</span>            <span class="o">+</span>
      <span class="o">|</span>            <span class="o">|</span>             \ <span class="p">(</span><span class="mi">5</span><span class="p">)</span>
      <span class="o">|</span>            <span class="o">|</span>             <span class="n">BC</span><span class="p">()</span>
      <span class="o">|</span>            <span class="o">|</span>             <span class="o">/</span>
      <span class="o">|</span>            <span class="o">|</span>            <span class="o">&lt;</span>

<span class="p">[</span> <span class="n">Chart</span><span class="p">:</span> <span class="n">Unit</span> <span class="mi">2</span> <span class="p">]</span>
     <span class="n">top</span>        <span class="n">arming</span>        <span class="n">armed</span>
      <span class="o">+</span><span class="n">start_at</span><span class="p">()</span><span class="o">-&gt;|</span>            <span class="o">|</span>
      <span class="o">|</span>    <span class="p">(</span><span class="mi">2</span><span class="p">)</span>     <span class="o">|</span>            <span class="o">|</span>
<span class="hll">      <span class="o">|</span>            <span class="o">+--</span><span class="n">OTHER</span><span class="p">()</span><span class="o">--&gt;|</span>
</span>      <span class="o">|</span>            <span class="o">|</span>    <span class="p">(</span><span class="mi">4</span><span class="p">)</span>     <span class="o">|</span>
      <span class="o">|</span>            <span class="o">|</span>            <span class="o">+</span>
      <span class="o">|</span>            <span class="o">|</span>             \ <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
      <span class="o">|</span>            <span class="o">|</span>             <span class="n">BC</span><span class="p">()</span>
      <span class="o">|</span>            <span class="o">|</span>             <span class="o">/</span>
      <span class="o">|</span>            <span class="o">|</span>            <span class="o">&lt;</span>
</pre></div>
</div>
<p>You can gang two tazors together to act as one tazor.  The first arming event
in your tazor network will also arm all of the other tazors, consider the
diagram above to see this interaction.</p>
<ol class="arabic simple">
<li>Tazor labeled ‘Unit 1’ turns on in the <cite>arming</cite> state.</li>
<li>Tazor labeled ‘Unit 2’ turns on in the <cite>arming</cite> state.</li>
<li>Unit 1 begins a battery charge (BC) which will send a broadcast message to
all other tazors in the network.</li>
<li>Unit 2 detects another tazor is beginning a battery charge, so it too begins
it’s battery charge (OTHER)</li>
</ol>
<p>…. and so on</p>
<p>If I changed the above design, it would be simple to adjust these diagrams and
their description.  Sequence diagrams are great for explaining small things,
but they do break the <a class="reference external" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> principle.  You are effectively replicating your
data by having these descriptions in your documentation.  The source <cite>image</cite> is
your state chart diagram.  Give it a lot of attention, since it is actually
your specification.  The sequence diagrams are little throw away things, that
can be used to assist in telling a very specific story about how your system
behaves.</p>
<p>I’m probably not following the UML standard, and I don’t care.  The utility of
the sequence diagram picture is in its simplicity.</p>
</div>
</div>
<div class="section" id="testing">
<span id="recipes-testing"></span><h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-a-trace-as-a-test-target">
<span id="recipes-using-a-trace-as-a-test-target"></span><h3>Using a Trace As a Test Target<a class="headerlink" href="#using-a-trace-as-a-test-target" title="Permalink to this headline">¶</a></h3>
<p>If you would like to sketch out the high level behavior of your statechart using
a trace output as the target for a regression test, you would:</p>
<ol class="arabic simple">
<li>Run your program and print your trace to the output.</li>
<li>Copy this trace as the target behavior of your test.</li>
<li>Run this trace target and the future output of the statechart trace through
the <a class="reference internal" href="reflection.html#stripped-example"><span class="std std-ref">stripped context manager</span></a> to remove the date
timestamp information.</li>
<li>Compare your target with the results.</li>
</ol>
<p>This should become clear with an example.</p>
<p>Consider a statechart that outputted the following at the point when you were
working on it.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">05</span> <span class="mi">21</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">56.098526</span><span class="p">]</span> <span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">05</span> <span class="mi">21</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">56.200047</span><span class="p">]</span> <span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">05</span> <span class="mi">21</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">56.300974</span><span class="p">]</span> <span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">05</span> <span class="mi">21</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">56.401682</span><span class="p">]</span> <span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>You might have gotten this output with the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">tazor</span><span class="o">.</span><span class="n">trace</span><span class="p">())</span>
</pre></div>
</div>
<p>It does a decent job describing what we want, but it has timestamps.  With the
<cite>stripped</cite> context manager we can turn the above into something that would look
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>That is something that shouldn’t change over time, it looks like something we
could use as a test specification.  The only problem is that when we run the
code in the future and generate a new trace we get a trace with a pre-pended
date timestamp.  We can get around this issue like this:</p>
<div class="highlight-python" id="stripped-example"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">stripped</span>

<span class="n">target</span> <span class="o">=</span> \
<span class="sd">&#39;&#39;&#39;[2017-11-05 21:31:56.098526] [tazor] e-&gt;start_at() top-&gt;arming</span>
<span class="sd">   [2017-11-05 21:31:56.200047] [tazor] e-&gt;BATTERY_CHARGE() arming-&gt;armed</span>
<span class="sd">   [2017-11-05 21:31:56.300974] [tazor] e-&gt;BATTERY_CHARGE() armed-&gt;armed</span>
<span class="sd">   [2017-11-05 21:31:56.401682] [tazor] e-&gt;BATTERY_CHARGE() armed-&gt;armed</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">with</span> <span class="n">stripped</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="k">as</span> <span class="n">stripped_target</span><span class="p">,</span> \
     <span class="n">stripped</span><span class="p">(</span><span class="n">tazor</span><span class="o">.</span><span class="n">trace</span><span class="p">())</span> <span class="k">as</span> <span class="n">stripped_trace_result</span><span class="p">:</span>

  <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">stripped_target</span><span class="p">,</span> <span class="n">stripped_trace_result</span><span class="p">):</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">target</span> <span class="o">==</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>On line <strong>1</strong> we import the stripped context manager.</p>
<p>On lines <strong>3-7</strong> we define the target as just being the trace that we copied
when we were first designing our statechart.</p>
<p>On line <strong>9</strong>, we map this target to the <code class="docutils literal"><span class="pre">stripped_target</span></code> which contains the
same string with the date timestamps removed.</p>
<p>On line <strong>10</strong>, we use the same stripped context manager to strip our tazor active
object’s trace output of it’s date timestamp information and place the result
into the <code class="docutils literal"><span class="pre">stripped_trace_result</span></code> variable.</p>
<p>Lines <strong>12-13</strong> are for testing each line of our output against our target.</p>
<p>If our design changes, it is easy to update the test, we just copy the new
trace of of new design into the target string and everything should be peachy.</p>
</div>
<div class="section" id="using-a-spy-as-a-test-target">
<h3>Using a Spy as a Test Target<a class="headerlink" href="#using-a-spy-as-a-test-target" title="Permalink to this headline">¶</a></h3>
<p>A trace does not tell the full story about what you system is doing.  For
instance it is blind to hooks, deferred events and many other things that might
happen in the dynamics of your active object.  If you need to look down the
exact behavior of your system, you can:</p>
<ol class="arabic simple">
<li>Run your program and print your spy to the output.</li>
<li>Copy the spy as your target behavior.</li>
<li>Compare the target with the results.</li>
</ol>
<p>Here is an example:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># pp(tazor.spy())</span>
</span><span class="hll"><span class="c1"># import pdb.set_trace()</span>
</span><span class="hll"><span class="k">assert</span><span class="p">(</span><span class="n">tazor</span><span class="o">.</span><span class="n">spy</span><span class="p">()</span> <span class="o">==</span>
</span>  <span class="p">[</span><span class="s1">&#39;START&#39;</span><span class="p">,</span>
   <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:arming&#39;</span><span class="p">,</span>
   <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:tazor_operating&#39;</span><span class="p">,</span>
   <span class="s1">&#39;ENTRY_SIGNAL:tazor_operating&#39;</span><span class="p">,</span>
   <span class="s1">&#39;ENTRY_SIGNAL:arming&#39;</span><span class="p">,</span>
   <span class="s1">&#39;INIT_SIGNAL:arming&#39;</span><span class="p">,</span>
   <span class="s1">&#39;&lt;- Queued:(0) Deferred:(0)&#39;</span><span class="p">,</span>
   <span class="s1">&#39;BATTERY_CHARGE:arming&#39;</span><span class="p">,</span>
   <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:armed&#39;</span><span class="p">,</span>
   <span class="s1">&#39;ENTRY_SIGNAL:armed&#39;</span><span class="p">,</span>
   <span class="s1">&#39;POST_DEFERRED:CAPACITOR_CHARGE&#39;</span><span class="p">,</span>
   <span class="s1">&#39;INIT_SIGNAL:armed&#39;</span><span class="p">,</span>
   <span class="s1">&#39;&lt;- Queued:(0) Deferred:(1)&#39;</span><span class="p">])</span>
</pre></div>
</td></tr></table></div>
<p>On line <strong>1</strong> we have a commented pretty print command ready to go for when we
need to rebuild our test specification.  When the test fails in the future,
which it will because this is a tightly coupled test, we will uncomment lines
<strong>1-2</strong> then re-run the test.</p>
<p>This will drop us into a debugging session just after our next spy output has
been printed to the screen.  At this point we would carefully determine if it
actually describes the new behavior we are looking for. If it wasn’t, we would
fix the issue, otherwise we over-write lines <strong>4-16</strong> with this new
specification.</p>
<p>We would re-comment lines <strong>1-2</strong> and re-run our tests.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="index.html">
  <img class="logo_a" src="_static/miros_a.svg" width="250" alt="Logo" >
</a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Recipes</a><ul>
<li><a class="reference internal" href="#events-and-signals">Events And Signals</a><ul>
<li><a class="reference internal" href="#creating-an-event">Creating an Event</a></li>
<li><a class="reference internal" href="#creating-a-signal">Creating a Signal</a></li>
<li><a class="reference internal" href="#recipes-seeing-what-signals-you-have-in-your-system">Posting Events</a></li>
<li><a class="reference internal" href="#posting-an-event-to-the-fifo">Posting an Event to the Fifo</a></li>
<li><a class="reference internal" href="#posting-an-event-to-the-lifo">Posting an Event to the Lifo</a></li>
<li><a class="reference internal" href="#creating-a-one-shot-event">Creating a One-Shot Event</a></li>
<li><a class="reference internal" href="#creating-a-multishot-event">Creating a Multishot Event</a></li>
<li><a class="reference internal" href="#cancelling-a-specific-event-source">Cancelling a Specific Event Source</a></li>
<li><a class="reference internal" href="#cancelling-event-source-by-signal-name">Cancelling Event Source By Signal Name</a></li>
<li><a class="reference internal" href="#deferring-and-recalling-an-event">Deferring and Recalling An Event</a></li>
</ul>
</li>
<li><a class="reference internal" href="#seeing-what-is-going-on">Seeing What is Going On</a><ul>
<li><a class="reference internal" href="#determining-the-current-state">Determining the Current State</a></li>
<li><a class="reference internal" href="#seeing-what-signals-you-have-in-your-system">Seeing what Signals You Have In Your System</a></li>
<li><a class="reference internal" href="#using-the-trace">Using the Trace</a></li>
<li><a class="reference internal" href="#using-the-spy">Using the Spy</a></li>
<li><a class="reference internal" href="#tracing-live">Tracing Live</a></li>
<li><a class="reference internal" href="#spying-live">Spying Live</a></li>
</ul>
</li>
<li><a class="reference internal" href="#describing-your-work">Describing your Work</a><ul>
<li><a class="reference internal" href="#drawing-a-statechart">Drawing a StateChart</a></li>
<li><a class="reference internal" href="#drawing-a-sequence-diagram">Drawing a Sequence Diagram</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing">Testing</a><ul>
<li><a class="reference internal" href="#using-a-trace-as-a-test-target">Using a Trace As a Test Target</a></li>
<li><a class="reference internal" href="#using-a-spy-as-a-test-target">Using a Spy as a Test Target</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="postingexample.html" title="previous chapter">Simple Posting Example</a></li>
      <li>Next: <a href="patterns.html" title="next chapter">Patterns</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/recipes.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Scott Volk.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/recipes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>